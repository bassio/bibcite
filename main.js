/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => BibcitePlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian3 = require("obsidian");

// CitationSuggest.ts
var import_obsidian = require("obsidian");

// ZoteroFunctions.ts
var http = require("http");
function makeHttpRequest(options, data) {
  return new Promise((resolve, reject) => {
    const req = http.request(options, (res) => {
      let responseData = "";
      res.on("data", (chunk) => {
        responseData += chunk;
      });
      res.on("end", () => {
        resolve(responseData);
      });
    });
    req.on("error", (error) => {
      reject(error);
    });
    if (data) {
      req.write(data);
    }
    req.end();
  });
}
async function locateCollection(collectionPath) {
  const jsonRpcData = {
    jsonrpc: "2.0",
    method: "user.groups",
    params: [true]
  };
  const options = {
    hostname: "localhost",
    port: 23119,
    path: "/better-bibtex/json-rpc",
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Content-Length": JSON.stringify(jsonRpcData).length
    }
  };
  const responseStr = await makeHttpRequest(options, JSON.stringify(jsonRpcData));
  const responseJson = JSON.parse(responseStr);
  const result = responseJson.result;
  const plist = collectionPath.split("/");
  const lib = plist[0];
  const after = plist.slice(1);
  const libNames = result.map((l) => l.name);
  const libIds = result.map((l) => l.id);
  const matchedLib = result[libNames.indexOf(lib)];
  const matchedLibId = libIds[libNames.indexOf(lib)];
  const allCollections = matchedLib.collections;
  const allCollectionsDict = {};
  allCollections.forEach((c) => {
    allCollectionsDict[c.key] = { ...c, children: [] };
  });
  const topCollections = allCollections.filter((c) => !c.parentCollection);
  const topCollectionsDict = {};
  topCollections.forEach((c) => {
    topCollectionsDict[c.key] = { ...c, children: [] };
  });
  const nonTopCollections = matchedLib.collections.filter((c) => c.parentCollection !== false);
  for (const coll of nonTopCollections) {
    if (coll.parentCollection in topCollectionsDict) {
      topCollectionsDict[coll.parentCollection].children.push(coll);
    }
  }
  const matchedTopCollection = topCollections.find((c) => c.name === after[0]);
  const matchedTopCollectionKey = matchedTopCollection.key;
  let children = Object.values(allCollectionsDict).filter((c) => c.parentCollection === matchedTopCollectionKey);
  let matchedChildCollectionKey = null;
  for (const cname of after.slice(1)) {
    if (matchedChildCollectionKey) {
      children = Object.values(allCollectionsDict).filter((c) => c.parentCollection === matchedChildCollectionKey);
    }
    for (const child of children) {
      if (cname === child.name) {
        matchedChildCollectionKey = child.key;
        break;
      }
    }
  }
  return { libraryId: matchedLibId, collectionId: matchedChildCollectionKey };
}
async function exportCollection(collectionId, libraryId, bibFormat = "betterbibtex") {
  const url_path = `/better-bibtex/collection?/${libraryId}/${collectionId}.${bibFormat}`;
  const url = `http://127.0.0.1:23119/better-bibtex/collection?/${libraryId}/${collectionId}.${bibFormat}`;
  const options = {
    hostname: "localhost",
    port: 23119,
    path: url_path,
    method: "GET",
    headers: {
      "Content-Type": "application/json"
    }
  };
  const responseStr = await makeHttpRequest(options);
  const responseJson = JSON.parse(responseStr);
  return responseJson;
}
async function exportItems(citeKeys, translator, libraryID) {
  const jsonRpcData = {
    jsonrpc: "2.0",
    method: "item.export",
    params: [citeKeys, translator, libraryID]
  };
  const options = {
    hostname: "localhost",
    port: 23119,
    path: "/better-bibtex/json-rpc",
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Content-Length": JSON.stringify(jsonRpcData).length
    }
  };
  const responseStr = await makeHttpRequest(options, JSON.stringify(jsonRpcData));
  const responseJson = JSON.parse(responseStr);
  const result = responseJson.result;
  try {
    return result[2];
  } catch (e) {
    return "[]";
  }
}
async function attachments(citeKey) {
  const jsonRpcData = {
    jsonrpc: "2.0",
    method: "item.attachments",
    params: [citeKey]
  };
  const options = {
    hostname: "localhost",
    port: 23119,
    path: "/better-bibtex/json-rpc",
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Content-Length": JSON.stringify(jsonRpcData).length
    }
  };
  const responseStr = await makeHttpRequest(options, JSON.stringify(jsonRpcData));
  const responseJson = JSON.parse(responseStr);
  return responseJson.result;
}
async function exportCollectionPath(collectionPath, bibFormat = "betterbibtex") {
  try {
    const coll = await locateCollection(collectionPath);
    const exported_collection = await exportCollection(coll.collectionId, coll.libraryId, bibFormat);
    return exported_collection;
  } catch (error) {
    console.error("Error:", error);
  }
}
async function collectionCitekeysTitles(collectionPath) {
  const resultJson = await exportCollectionPath(collectionPath, "json");
  const result_keys_title = resultJson.map((item) => {
    return { "id": item.id, "title": item.title };
  });
  return result_keys_title;
}

// CitationSuggest.ts
var CitationSuggest = class extends import_obsidian.EditorSuggest {
  constructor(app, plugin) {
    super(app);
    this.app = app;
    this.plugin = plugin;
    this.justCompleted = false;
  }
  onTrigger(cursor, editor, file) {
    var _a, _b;
    if (this.justCompleted) {
      this.justCompleted = false;
      return null;
    }
    const triggerPhrase = "@";
    const startPos = ((_a = this.context) == null ? void 0 : _a.start) || {
      line: cursor.line,
      ch: cursor.ch - triggerPhrase.length
    };
    const lineToCursor = editor.getRange(
      { line: startPos.line, ch: 0 },
      { line: startPos.line, ch: cursor.ch }
    );
    if (lineToCursor.lastIndexOf("[") == -1) {
      return null;
    } else {
      if (lineToCursor.lastIndexOf("[") < lineToCursor.lastIndexOf("]")) {
        return null;
      } else {
      }
      ;
    }
    const OpenBracketToCursor = lineToCursor.substring(lineToCursor.lastIndexOf("[") + 1);
    const precedingChar = editor.getRange(
      { line: startPos.line, ch: cursor.ch - 1 },
      { line: startPos.line, ch: cursor.ch }
    );
    const followingChar = editor.getRange(
      { line: startPos.line, ch: cursor.ch },
      { line: startPos.line, ch: cursor.ch + 1 }
    );
    if (!OpenBracketToCursor.startsWith("@")) {
      return null;
    }
    if (precedingChar == " " || precedingChar == ";") {
      return null;
    }
    const LastAtSignToCursor = OpenBracketToCursor.substring(OpenBracketToCursor.lastIndexOf("@") + 1);
    const LastAtSignLinePos = lineToCursor.lastIndexOf("@");
    const queryStartPos = ((_b = this.context) == null ? void 0 : _b.start) || {
      line: cursor.line,
      ch: LastAtSignLinePos
    };
    const noteFile = file;
    const frontMatter = this.app.metadataCache.getFileCache(noteFile).frontmatter;
    this.zotero_collection = frontMatter.zotero_collection;
    const query = LastAtSignToCursor;
    return {
      start: queryStartPos,
      end: cursor,
      query
    };
  }
  async getSuggestions(context) {
    const suggestions = await collectionCitekeysTitles(this.zotero_collection);
    if (suggestions.length) {
      return suggestions.filter(
        (item) => item["id"].startsWith(context.query)
      );
    }
    return [{ label: context.query }];
  }
  renderSuggestion(suggestion, el) {
    el.setText("@" + suggestion["id"]);
    el.innerHTML += "<br>";
    el.append(suggestion["title"]);
  }
  selectSuggestion(suggestion, event) {
    const { editor } = this.context;
    const precedingChar = editor.getRange(
      { line: this.context.start.line, ch: this.context.start.ch - 1 },
      { line: this.context.start.line, ch: this.context.start.ch }
    );
    const followingChar = editor.getRange(
      { line: this.context.start.line, ch: this.context.end.ch },
      { line: this.context.start.line, ch: this.context.end.ch + 1 }
    );
    const suggStr = "@" + suggestion.id;
    let cursorEndPos = null;
    if (followingChar == "]") {
      cursorEndPos = this.context.start.ch + suggStr.length + 1;
    } else {
      cursorEndPos = this.context.start.ch + suggStr.length;
    }
    editor.replaceRange(suggStr, this.context.start, { "line": this.context.end.line, "ch": this.context.end.ch });
    editor.setCursor({ "line": this.context.start.line, "ch": cursorEndPos });
    this.justCompleted = true;
  }
};

// ReferencesView.ts
var import_obsidian2 = require("obsidian");
var ReferencesViewType = "ReferencesView";
var ReferencesView = class extends import_obsidian2.ItemView {
  constructor(leaf, plugin) {
    super(leaf);
    this.processReferences = async () => {
      const refs = await this.plugin.processReferences();
      this.setViewContent(await this.renderReferences(refs));
    };
    this.plugin = plugin;
    this.contentEl.addClass("bibcite-references");
    this.setNoContentMessage();
    this.addAction("refresh-cw", "Refresh References", () => {
      this.processReferences();
    });
  }
  setViewContent(bib) {
    this.contentEl.empty();
    this.button = this.contentEl.createEl("button", { text: "Refresh Bibiography" });
    this.button.onclick = (e) => {
      this.processReferences();
    };
    if (!bib) {
      this.setNoContentMessage();
    } else {
      this.contentEl.append(bib);
    }
  }
  setNoContentMessage() {
    this.setMessage("No citations found in the current document.");
  }
  setMessage(message) {
    this.contentEl.empty();
    this.button = this.contentEl.createEl("button", { text: "Refresh Bibiography" });
    this.button.onclick = (e) => {
      this.processReferences();
    };
    this.contentEl.createDiv({
      cls: "pane-empty",
      text: message
    });
  }
  getViewType() {
    return ReferencesViewType;
  }
  getDisplayText() {
    return "References";
  }
  getIcon() {
    return "graduation-cap";
  }
  async renderReferences(refsArray) {
    const containerDiv = document.createElement("div");
    const refData = JSON.parse(await exportItems(refsArray, "json", "ENT"));
    console.log(refsArray);
    for (const item of refsArray) {
      const itemDiv = document.createElement("div");
      itemDiv.classList.add("reference-div");
      const itemData = refData.flat(1).filter((r) => r["id"] == item)[0];
      itemData["attachments"] = await attachments(item);
      const itemAttachments = itemData["attachments"].filter((attach) => attach.path != false);
      itemDiv.innerHTML += `<div class="reference-citekey">@${itemData["id"]}<div>`;
      if (itemAttachments.length) {
        const linkAttachment = itemAttachments[0]["open"];
        itemDiv.innerHTML += `<div class="reference-title"><a href='${linkAttachment}'>${itemData["title"]}</a></div>`;
      } else {
        itemDiv.innerHTML += `<div class="reference-title">${itemData["title"]}</div>`;
      }
      const journal = itemData["container-title-short"] != "" ? itemData["container-title-short"] : itemData["container-title"];
      const issueDate = itemData["issued"]["date-parts"][0][0] != void 0 ? itemData["issued"]["date-parts"][0][0] : "";
      itemDiv.innerHTML += `<div class="reference-journal">${journal} ${issueDate}</div>`;
      containerDiv.appendChild(itemDiv);
    }
    return containerDiv;
  }
};

// main.ts
var DEFAULT_SETTINGS = {
  mySetting: "default"
};
var BibcitePlugin = class extends import_obsidian3.Plugin {
  constructor() {
    super(...arguments);
    this.processReferences = async () => {
      const { settings, view } = this;
      const activeView = this.app.workspace.getActiveFileView();
      const activeFile = this.app.workspace.getActiveFile();
      if (activeFile) {
        try {
          const fileContent = await this.app.vault.cachedRead(activeView.file);
          const cache = this.app.metadataCache.fileCache[activeFile.path];
          const re = /\[(@[a-zA-Z0-9_-]+[ ]*;?[ ]*)+\]/g;
          const matches = fileContent.match(re).map((item) => item.slice(1, -1).split(";").map((i) => i.trim().replace("@", "")));
          const matches_unique = new Set(matches.flat(1));
          return [...matches_unique];
        } catch (e) {
          console.error(e);
        }
      } else {
        return [];
      }
      ;
    };
  }
  async onload() {
    console.log("Loading Bibcite plugin.");
    await this.loadSettings();
    this.registerEditorSuggest(new CitationSuggest(this.app, this));
    this.registerView(
      ReferencesViewType,
      (leaf) => new ReferencesView(leaf, this)
    );
    this.addCommand({
      id: "show-references-view",
      name: "Show References",
      callback: async () => {
        this.initLeaf();
      }
    });
    await this.initLeaf();
  }
  onunload() {
    this.app.workspace.getLeavesOfType(ReferencesViewType).forEach((leaf) => leaf.detach());
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
  get view() {
    const leaves = this.app.workspace.getLeavesOfType(ReferencesViewType);
    if (!(leaves == null ? void 0 : leaves.length))
      return null;
    return leaves[0].view;
  }
  async initLeaf() {
    if (this.view)
      return this.revealLeaf();
    await this.app.workspace.getRightLeaf(false).setViewState({
      type: ReferencesViewType
    });
    this.revealLeaf();
    const activeView = this.app.workspace.getActiveViewOfType(import_obsidian3.MarkdownView);
    if (activeView) {
      this.processReferences();
    }
  }
  revealLeaf() {
    const leaves = this.app.workspace.getLeavesOfType(ReferencesViewType);
    if (!(leaves == null ? void 0 : leaves.length))
      return;
    this.app.workspace.revealLeaf(leaves[0]);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyIsICJDaXRhdGlvblN1Z2dlc3QudHMiLCAiWm90ZXJvRnVuY3Rpb25zLnRzIiwgIlJlZmVyZW5jZXNWaWV3LnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgeyBBcHAsIEVkaXRvciwgTWFya2Rvd25WaWV3LCBNb2RhbCwgTm90aWNlLCBQbHVnaW4sIFBsdWdpblNldHRpbmdUYWIsIFNldHRpbmcsIFdvcmtzcGFjZUxlYWYgfSBmcm9tICdvYnNpZGlhbic7XG5cbmltcG9ydCB7IENpdGF0aW9uU3VnZ2VzdCB9IGZyb20gXCJDaXRhdGlvblN1Z2dlc3QudHNcIjtcbmltcG9ydCB7IFJlZmVyZW5jZXNWaWV3LCBSZWZlcmVuY2VzVmlld1R5cGUgfSBmcm9tICcuL1JlZmVyZW5jZXNWaWV3LnRzJztcblxuLy8gUmVtZW1iZXIgdG8gcmVuYW1lIHRoZXNlIGNsYXNzZXMgYW5kIGludGVyZmFjZXMhXG5cbmludGVyZmFjZSBCaWJjaXRlUGx1Z2luU2V0dGluZ3Mge1xuXHRteVNldHRpbmc6IHN0cmluZztcbn1cblxuY29uc3QgREVGQVVMVF9TRVRUSU5HUzogQmliY2l0ZVBsdWdpblNldHRpbmdzID0ge1xuXHRteVNldHRpbmc6ICdkZWZhdWx0J1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBCaWJjaXRlUGx1Z2luIGV4dGVuZHMgUGx1Z2luIHtcblx0c2V0dGluZ3M6IEJpYmNpdGVQbHVnaW5TZXR0aW5ncztcblxuXHRhc3luYyBvbmxvYWQoKSB7XG5cblx0XHRjb25zb2xlLmxvZyhcIkxvYWRpbmcgQmliY2l0ZSBwbHVnaW4uXCIpXG5cblx0XHRhd2FpdCB0aGlzLmxvYWRTZXR0aW5ncygpO1xuXG5cdFx0dGhpcy5yZWdpc3RlckVkaXRvclN1Z2dlc3QobmV3IENpdGF0aW9uU3VnZ2VzdCh0aGlzLmFwcCwgdGhpcykpO1xuXG5cdFx0dGhpcy5yZWdpc3RlclZpZXcoUmVmZXJlbmNlc1ZpZXdUeXBlLFxuXHRcdFx0XHRcdFx0IChsZWFmOiBXb3Jrc3BhY2VMZWFmKSA9PiBuZXcgUmVmZXJlbmNlc1ZpZXcobGVhZiwgdGhpcylcblx0XHRcdFx0XHRcdCAgKTtcblxuXHRcdHRoaXMuYWRkQ29tbWFuZCh7XG5cdFx0XHRpZDogJ3Nob3ctcmVmZXJlbmNlcy12aWV3Jyxcblx0XHRcdG5hbWU6ICdTaG93IFJlZmVyZW5jZXMnLFxuXHRcdFx0Y2FsbGJhY2s6IGFzeW5jICgpID0+IHtcblx0XHRcdFx0dGhpcy5pbml0TGVhZigpO1xuXHRcdFx0fSxcblx0XHR9KTtcblxuXHRcdC8vdGhpcy5hcHAud29ya3NwYWNlLm9uKFwiYWN0aXZlLWxlYWYtY2hhbmdlXCIsICgpID0+IHtcblx0XHQvL1x0Y29uc29sZS5sb2coXCJBY3RpdmUgbGVhZiBjaGFuZ2VkIVwiKVxuXHRcdC8vXHQvL3RoaXMuaW5pdExlYWYoKVxuXHRcdC8vfSlcblxuXHRcdGF3YWl0IHRoaXMuaW5pdExlYWYoKTtcblxuXHRcdC8qXG5cdFx0Ly8gVGhpcyBjcmVhdGVzIGFuIGljb24gaW4gdGhlIGxlZnQgcmliYm9uLlxuXHRcdGNvbnN0IHJpYmJvbkljb25FbCA9IHRoaXMuYWRkUmliYm9uSWNvbignZGljZScsICdTYW1wbGUgUGx1Z2luJywgKGV2dDogTW91c2VFdmVudCkgPT4ge1xuXHRcdFx0Ly8gQ2FsbGVkIHdoZW4gdGhlIHVzZXIgY2xpY2tzIHRoZSBpY29uLlxuXHRcdFx0bmV3IE5vdGljZSgnVGhpcyBpcyBhIG5vdGljZSEnKTtcblx0XHR9KTtcblx0XHQvLyBQZXJmb3JtIGFkZGl0aW9uYWwgdGhpbmdzIHdpdGggdGhlIHJpYmJvblxuXHRcdHJpYmJvbkljb25FbC5hZGRDbGFzcygnbXktcGx1Z2luLXJpYmJvbi1jbGFzcycpO1xuXG5cdFx0Ly8gVGhpcyBhZGRzIGEgc3RhdHVzIGJhciBpdGVtIHRvIHRoZSBib3R0b20gb2YgdGhlIGFwcC4gRG9lcyBub3Qgd29yayBvbiBtb2JpbGUgYXBwcy5cblx0XHRjb25zdCBzdGF0dXNCYXJJdGVtRWwgPSB0aGlzLmFkZFN0YXR1c0Jhckl0ZW0oKTtcblx0XHRzdGF0dXNCYXJJdGVtRWwuc2V0VGV4dCgnU3RhdHVzIEJhciBUZXh0Jyk7XG5cblx0XHQvLyBUaGlzIGFkZHMgYSBzaW1wbGUgY29tbWFuZCB0aGF0IGNhbiBiZSB0cmlnZ2VyZWQgYW55d2hlcmVcblx0XHR0aGlzLmFkZENvbW1hbmQoe1xuXHRcdFx0aWQ6ICdvcGVuLXNhbXBsZS1tb2RhbC1zaW1wbGUnLFxuXHRcdFx0bmFtZTogJ09wZW4gc2FtcGxlIG1vZGFsIChzaW1wbGUpJyxcblx0XHRcdGNhbGxiYWNrOiAoKSA9PiB7XG5cdFx0XHRcdG5ldyBTYW1wbGVNb2RhbCh0aGlzLmFwcCkub3BlbigpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdC8vIFRoaXMgYWRkcyBhbiBlZGl0b3IgY29tbWFuZCB0aGF0IGNhbiBwZXJmb3JtIHNvbWUgb3BlcmF0aW9uIG9uIHRoZSBjdXJyZW50IGVkaXRvciBpbnN0YW5jZVxuXHRcdHRoaXMuYWRkQ29tbWFuZCh7XG5cdFx0XHRpZDogJ3NhbXBsZS1lZGl0b3ItY29tbWFuZCcsXG5cdFx0XHRuYW1lOiAnU2FtcGxlIGVkaXRvciBjb21tYW5kJyxcblx0XHRcdGVkaXRvckNhbGxiYWNrOiAoZWRpdG9yOiBFZGl0b3IsIHZpZXc6IE1hcmtkb3duVmlldykgPT4ge1xuXHRcdFx0XHRjb25zb2xlLmxvZyhlZGl0b3IuZ2V0U2VsZWN0aW9uKCkpO1xuXHRcdFx0XHRlZGl0b3IucmVwbGFjZVNlbGVjdGlvbignU2FtcGxlIEVkaXRvciBDb21tYW5kJyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0Ly8gVGhpcyBhZGRzIGEgY29tcGxleCBjb21tYW5kIHRoYXQgY2FuIGNoZWNrIHdoZXRoZXIgdGhlIGN1cnJlbnQgc3RhdGUgb2YgdGhlIGFwcCBhbGxvd3MgZXhlY3V0aW9uIG9mIHRoZSBjb21tYW5kXG5cdFx0dGhpcy5hZGRDb21tYW5kKHtcblx0XHRcdGlkOiAnb3Blbi1zYW1wbGUtbW9kYWwtY29tcGxleCcsXG5cdFx0XHRuYW1lOiAnT3BlbiBzYW1wbGUgbW9kYWwgKGNvbXBsZXgpJyxcblx0XHRcdGNoZWNrQ2FsbGJhY2s6IChjaGVja2luZzogYm9vbGVhbikgPT4ge1xuXHRcdFx0XHQvLyBDb25kaXRpb25zIHRvIGNoZWNrXG5cdFx0XHRcdGNvbnN0IG1hcmtkb3duVmlldyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVWaWV3T2ZUeXBlKE1hcmtkb3duVmlldyk7XG5cdFx0XHRcdGlmIChtYXJrZG93blZpZXcpIHtcblx0XHRcdFx0XHQvLyBJZiBjaGVja2luZyBpcyB0cnVlLCB3ZSdyZSBzaW1wbHkgXCJjaGVja2luZ1wiIGlmIHRoZSBjb21tYW5kIGNhbiBiZSBydW4uXG5cdFx0XHRcdFx0Ly8gSWYgY2hlY2tpbmcgaXMgZmFsc2UsIHRoZW4gd2Ugd2FudCB0byBhY3R1YWxseSBwZXJmb3JtIHRoZSBvcGVyYXRpb24uXG5cdFx0XHRcdFx0aWYgKCFjaGVja2luZykge1xuXHRcdFx0XHRcdFx0bmV3IFNhbXBsZU1vZGFsKHRoaXMuYXBwKS5vcGVuKCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gVGhpcyBjb21tYW5kIHdpbGwgb25seSBzaG93IHVwIGluIENvbW1hbmQgUGFsZXR0ZSB3aGVuIHRoZSBjaGVjayBmdW5jdGlvbiByZXR1cm5zIHRydWVcblx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0Ly8gVGhpcyBhZGRzIGEgc2V0dGluZ3MgdGFiIHNvIHRoZSB1c2VyIGNhbiBjb25maWd1cmUgdmFyaW91cyBhc3BlY3RzIG9mIHRoZSBwbHVnaW5cblx0XHR0aGlzLmFkZFNldHRpbmdUYWIobmV3IFNhbXBsZVNldHRpbmdUYWIodGhpcy5hcHAsIHRoaXMpKTtcblxuXHRcdC8vIElmIHRoZSBwbHVnaW4gaG9va3MgdXAgYW55IGdsb2JhbCBET00gZXZlbnRzIChvbiBwYXJ0cyBvZiB0aGUgYXBwIHRoYXQgZG9lc24ndCBiZWxvbmcgdG8gdGhpcyBwbHVnaW4pXG5cdFx0Ly8gVXNpbmcgdGhpcyBmdW5jdGlvbiB3aWxsIGF1dG9tYXRpY2FsbHkgcmVtb3ZlIHRoZSBldmVudCBsaXN0ZW5lciB3aGVuIHRoaXMgcGx1Z2luIGlzIGRpc2FibGVkLlxuXHRcdHRoaXMucmVnaXN0ZXJEb21FdmVudChkb2N1bWVudCwgJ2NsaWNrJywgKGV2dDogTW91c2VFdmVudCkgPT4ge1xuXHRcdFx0Y29uc29sZS5sb2coJ2NsaWNrJywgZXZ0KTtcblx0XHR9KTtcblxuXHRcdC8vIFdoZW4gcmVnaXN0ZXJpbmcgaW50ZXJ2YWxzLCB0aGlzIGZ1bmN0aW9uIHdpbGwgYXV0b21hdGljYWxseSBjbGVhciB0aGUgaW50ZXJ2YWwgd2hlbiB0aGUgcGx1Z2luIGlzIGRpc2FibGVkLlxuXHRcdHRoaXMucmVnaXN0ZXJJbnRlcnZhbCh3aW5kb3cuc2V0SW50ZXJ2YWwoKCkgPT4gY29uc29sZS5sb2coJ3NldEludGVydmFsJyksIDUgKiA2MCAqIDEwMDApKTtcblx0XHQqL1xuXG5cdH1cblxuXHRvbnVubG9hZCgpIHtcblx0XHR0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhdmVzT2ZUeXBlKFJlZmVyZW5jZXNWaWV3VHlwZSlcblx0XHQuZm9yRWFjaCgobGVhZikgPT4gbGVhZi5kZXRhY2goKSk7XG5cdH1cblxuXHRhc3luYyBsb2FkU2V0dGluZ3MoKSB7XG5cdFx0dGhpcy5zZXR0aW5ncyA9IE9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfU0VUVElOR1MsIGF3YWl0IHRoaXMubG9hZERhdGEoKSk7XG5cdH1cblxuXHRhc3luYyBzYXZlU2V0dGluZ3MoKSB7XG5cdFx0YXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcblx0fVxuXG5cdGdldCB2aWV3KCkge1xuXHRcdGNvbnN0IGxlYXZlcyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWF2ZXNPZlR5cGUoUmVmZXJlbmNlc1ZpZXdUeXBlKTtcblx0XHRpZiAoIWxlYXZlcz8ubGVuZ3RoKSByZXR1cm4gbnVsbDtcblx0XHRyZXR1cm4gbGVhdmVzWzBdLnZpZXcgYXMgUmVmZXJlbmNlc1ZpZXc7XG5cdH1cblxuXHRhc3luYyBpbml0TGVhZigpIHtcblx0XHRpZiAodGhpcy52aWV3KSByZXR1cm4gdGhpcy5yZXZlYWxMZWFmKCk7XG5cblx0XHRhd2FpdCB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0UmlnaHRMZWFmKGZhbHNlKS5zZXRWaWV3U3RhdGUoe1xuXHRcdFx0dHlwZTogUmVmZXJlbmNlc1ZpZXdUeXBlLFxuXHRcdH0pO1xuXG5cdFx0dGhpcy5yZXZlYWxMZWFmKCk7XG5cblx0XHRjb25zdCBhY3RpdmVWaWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KTtcblx0XHRpZiAoYWN0aXZlVmlldykge1xuXHRcdFx0dGhpcy5wcm9jZXNzUmVmZXJlbmNlcygpO1xuXHRcdH1cblx0fVxuXG5cdHJldmVhbExlYWYoKSB7XG5cdFx0Y29uc3QgbGVhdmVzID0gdGhpcy5hcHAud29ya3NwYWNlLmdldExlYXZlc09mVHlwZShSZWZlcmVuY2VzVmlld1R5cGUpO1xuXHRcdGlmICghbGVhdmVzPy5sZW5ndGgpIHJldHVybjtcblx0XHR0aGlzLmFwcC53b3Jrc3BhY2UucmV2ZWFsTGVhZihsZWF2ZXNbMF0pO1xuXHR9XG5cblx0cHJvY2Vzc1JlZmVyZW5jZXMgPSBhc3luYyAoKSA9PiB7XG5cblx0XHRjb25zdCB7IHNldHRpbmdzLCB2aWV3IH0gPSB0aGlzO1xuXG5cdFx0Y29uc3QgYWN0aXZlVmlldyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVGaWxlVmlldygpO1xuXHRcdGNvbnN0IGFjdGl2ZUZpbGUgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlRmlsZSgpO1xuXG5cdFx0aWYgKGFjdGl2ZUZpbGUpIHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdGNvbnN0IGZpbGVDb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQuY2FjaGVkUmVhZChhY3RpdmVWaWV3LmZpbGUpO1xuXHRcdFx0XHRjb25zdCBjYWNoZSA9IHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZmlsZUNhY2hlW2FjdGl2ZUZpbGUucGF0aF07XG5cblx0XHRcdFx0Y29uc3QgcmUgPSAvXFxbKEBbYS16QS1aMC05Xy1dK1sgXSo7P1sgXSopK1xcXS9nXG5cblx0XHRcdFx0Y29uc3QgbWF0Y2hlcyA9IGZpbGVDb250ZW50Lm1hdGNoKHJlKS5tYXAoaXRlbSA9PiBpdGVtLnNsaWNlKDEsIC0xKS5zcGxpdChcIjtcIikubWFwKCBpID0+IGkudHJpbSgpLnJlcGxhY2UoXCJAXCIsIFwiXCIpICkpO1xuXG5cdFx0XHRcdGNvbnN0IG1hdGNoZXNfdW5pcXVlID0gbmV3IFNldChtYXRjaGVzLmZsYXQoMSkpXG5cblx0XHRcdFx0cmV0dXJuICBbLi4ubWF0Y2hlc191bmlxdWVdO1xuXG5cdFx0XHR9IGNhdGNoIChlKSB7XG5cdFx0XHRcdGNvbnNvbGUuZXJyb3IoZSk7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiBbXTtcblx0XHR9O1xuXHR9O1xufVxuXG5jbGFzcyBTYW1wbGVNb2RhbCBleHRlbmRzIE1vZGFsIHtcblx0Y29uc3RydWN0b3IoYXBwOiBBcHApIHtcblx0XHRzdXBlcihhcHApO1xuXHR9XG5cblx0b25PcGVuKCkge1xuXHRcdGNvbnN0IHtjb250ZW50RWx9ID0gdGhpcztcblx0XHRjb250ZW50RWwuc2V0VGV4dCgnV29haCEnKTtcblx0fVxuXG5cdG9uQ2xvc2UoKSB7XG5cdFx0Y29uc3Qge2NvbnRlbnRFbH0gPSB0aGlzO1xuXHRcdGNvbnRlbnRFbC5lbXB0eSgpO1xuXHR9XG59XG5cbmNsYXNzIFNhbXBsZVNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcblx0cGx1Z2luOiBCaWJjaXRlUGx1Z2luO1xuXG5cdGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IEJpYmNpdGVQbHVnaW4pIHtcblx0XHRzdXBlcihhcHAsIHBsdWdpbik7XG5cdFx0dGhpcy5wbHVnaW4gPSBwbHVnaW47XG5cdH1cblxuXHRkaXNwbGF5KCk6IHZvaWQge1xuXHRcdGNvbnN0IHtjb250YWluZXJFbH0gPSB0aGlzO1xuXG5cdFx0Y29udGFpbmVyRWwuZW1wdHkoKTtcblxuXHRcdG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuXHRcdFx0LnNldE5hbWUoJ1NldHRpbmcgIzEnKVxuXHRcdFx0LnNldERlc2MoJ0l0XFwncyBhIHNlY3JldCcpXG5cdFx0XHQuYWRkVGV4dCh0ZXh0ID0+IHRleHRcblx0XHRcdFx0LnNldFBsYWNlaG9sZGVyKCdFbnRlciB5b3VyIHNlY3JldCcpXG5cdFx0XHRcdC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5teVNldHRpbmcpXG5cdFx0XHRcdC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcblx0XHRcdFx0XHR0aGlzLnBsdWdpbi5zZXR0aW5ncy5teVNldHRpbmcgPSB2YWx1ZTtcblx0XHRcdFx0XHRhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcblx0XHRcdFx0fSkpO1xuXHR9XG59XG4iLCAiaW1wb3J0IHtcblx0QXBwLFxuXHRFZGl0b3IsXG5cdEVkaXRvclBvc2l0aW9uLFxuXHRFZGl0b3JTdWdnZXN0LFxuXHRFZGl0b3JTdWdnZXN0Q29udGV4dCxcblx0RWRpdG9yU3VnZ2VzdFRyaWdnZXJJbmZvLFxuXHRNYXJrZG93blZpZXcsXG5cdFRGaWxlLFxuXHRyZXF1ZXN0LFxuXHRyZXF1ZXN0VXJsXG59IGZyb20gJ29ic2lkaWFuJztcblxuaW1wb3J0IHtjb2xsZWN0aW9uQ2l0ZWtleXNUaXRsZXN9IGZyb20gJ1pvdGVyb0Z1bmN0aW9ucydcblxuaW1wb3J0IEJpYmNpdGVQbHVnaW4gZnJvbSAnbWFpbic7XG5cbmludGVyZmFjZSBTdWdnZXN0aW9uIHtcblx0cXVlcnk6IHN0cmluZztcblx0c3RhcnRJbmRleDogbnVtYmVyO1xuXHRsYWJlbDogc3RyaW5nO1xufVxuXG5cbmV4cG9ydCBjbGFzcyBDaXRhdGlvblN1Z2dlc3QgZXh0ZW5kcyBFZGl0b3JTdWdnZXN0PFN1Z2dlc3Rpb24+IHtcblx0cHJpdmF0ZSBwbHVnaW46IEJpYmNpdGVQbHVnaW47XG5cdHByaXZhdGUgcmVhZG9ubHkgYXBwOiBBcHA7XG5cdHByaXZhdGUganVzdENvbXBsZXRlZDogYm9vbGVhbjtcblx0cHJpdmF0ZSB6b3Rlcm9fY29sbGVjdGlvbjogc3RyaW5nO1xuXG5cdGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IEJpYmNpdGVQbHVnaW4pIHtcblx0XHRzdXBlcihhcHApO1xuXHRcdHRoaXMuYXBwID0gYXBwO1xuXHRcdHRoaXMucGx1Z2luID0gcGx1Z2luO1xuXHRcdHRoaXMuanVzdENvbXBsZXRlZCA9IGZhbHNlO1xuXHR9XG5cdG9uVHJpZ2dlcihcblx0XHRjdXJzb3I6IEVkaXRvclBvc2l0aW9uLFxuXHRcdGVkaXRvcjogRWRpdG9yLFxuXHRcdGZpbGU6IFRGaWxlXG5cdCk6IEVkaXRvclN1Z2dlc3RUcmlnZ2VySW5mbyB8IG51bGwge1xuXG5cdFx0aWYgKHRoaXMuanVzdENvbXBsZXRlZCkge1xuXHRcdFx0dGhpcy5qdXN0Q29tcGxldGVkID0gZmFsc2U7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblxuICAgICAgICBjb25zdCB0cmlnZ2VyUGhyYXNlID0gJ0AnO1xuICAgICAgICBjb25zdCBzdGFydFBvcyA9IHRoaXMuY29udGV4dD8uc3RhcnQgfHwge1xuXHRcdFx0bGluZTogY3Vyc29yLmxpbmUsXG5cdFx0XHRjaDogY3Vyc29yLmNoIC0gdHJpZ2dlclBocmFzZS5sZW5ndGgsXG5cdFx0fTtcblxuXHRcdGNvbnN0IGxpbmVUb0N1cnNvciA9IGVkaXRvci5nZXRSYW5nZSh7bGluZTogc3RhcnRQb3MubGluZSwgY2g6IDB9LFxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdCAge2xpbmU6IHN0YXJ0UG9zLmxpbmUsIGNoOiBjdXJzb3IuY2h9KTtcblxuXHRcdGlmIChsaW5lVG9DdXJzb3IubGFzdEluZGV4T2YoXCJbXCIpID09IC0xKSB7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9IGVsc2Uge1xuXHRcdFx0aWYgKGxpbmVUb0N1cnNvci5sYXN0SW5kZXhPZihcIltcIikgPCBsaW5lVG9DdXJzb3IubGFzdEluZGV4T2YoXCJdXCIpKXtcblx0XHRcdFx0cmV0dXJuIG51bGw7XG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHR9O1xuXHRcdH1cblxuXHRcdGNvbnN0IE9wZW5CcmFja2V0VG9DdXJzb3IgPSBsaW5lVG9DdXJzb3Iuc3Vic3RyaW5nKGxpbmVUb0N1cnNvci5sYXN0SW5kZXhPZihcIltcIikrMSlcblxuXHRcdGNvbnN0IHByZWNlZGluZ0NoYXIgPSBlZGl0b3IuZ2V0UmFuZ2Uoe2xpbmU6IHN0YXJ0UG9zLmxpbmUsIGNoOiBjdXJzb3IuY2ggLSAxfSxcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQgIHtsaW5lOiBzdGFydFBvcy5saW5lLCBjaDogY3Vyc29yLmNofSk7XG5cblx0XHRjb25zdCBmb2xsb3dpbmdDaGFyID0gZWRpdG9yLmdldFJhbmdlKHtsaW5lOiBzdGFydFBvcy5saW5lLCBjaDogY3Vyc29yLmNofSxcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQgIHtsaW5lOiBzdGFydFBvcy5saW5lLCBjaDogY3Vyc29yLmNoICsgMX0pO1xuXG5cblx0XHRpZiAoIU9wZW5CcmFja2V0VG9DdXJzb3Iuc3RhcnRzV2l0aChcIkBcIikpIHtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblxuXHRcdGlmICgocHJlY2VkaW5nQ2hhciA9PSBcIiBcIikgfHwgKHByZWNlZGluZ0NoYXIgPT0gXCI7XCIpKSB7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cblx0XHRjb25zdCBMYXN0QXRTaWduVG9DdXJzb3IgPSBPcGVuQnJhY2tldFRvQ3Vyc29yLnN1YnN0cmluZyhPcGVuQnJhY2tldFRvQ3Vyc29yLmxhc3RJbmRleE9mKFwiQFwiKSsxKVxuXG5cdFx0Y29uc3QgTGFzdEF0U2lnbkxpbmVQb3MgPSBsaW5lVG9DdXJzb3IubGFzdEluZGV4T2YoXCJAXCIpO1xuXG5cdFx0Y29uc3QgcXVlcnlTdGFydFBvcyA9IHRoaXMuY29udGV4dD8uc3RhcnQgfHwge1xuXHRcdFx0bGluZTogY3Vyc29yLmxpbmUsXG5cdFx0XHRjaDogTGFzdEF0U2lnbkxpbmVQb3MsXG5cdFx0fTtcblxuXHRcdGNvbnN0IG5vdGVGaWxlID0gZmlsZTtcblx0XHRjb25zdCBmcm9udE1hdHRlciA9IHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0RmlsZUNhY2hlKG5vdGVGaWxlKS5mcm9udG1hdHRlcjtcblxuXHRcdHRoaXMuem90ZXJvX2NvbGxlY3Rpb24gPSBmcm9udE1hdHRlci56b3Rlcm9fY29sbGVjdGlvblxuXG5cdFx0Y29uc3QgcXVlcnkgPSBMYXN0QXRTaWduVG9DdXJzb3I7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN0YXJ0OiBxdWVyeVN0YXJ0UG9zLFxuICAgICAgICAgICAgZW5kOiBjdXJzb3IsXG4gICAgICAgICAgICBxdWVyeTogcXVlcnksXG4gICAgICAgICAgICB9O1xuXG4gICAgfVxuXG5cdGFzeW5jIGdldFN1Z2dlc3Rpb25zKGNvbnRleHQ6IEVkaXRvclN1Z2dlc3RDb250ZXh0KTogU3VnZ2VzdGlvbltdIHtcblxuXHRcdGNvbnN0IHN1Z2dlc3Rpb25zID0gYXdhaXQgY29sbGVjdGlvbkNpdGVrZXlzVGl0bGVzKHRoaXMuem90ZXJvX2NvbGxlY3Rpb24pXG5cbiAgICAgICAgaWYgKHN1Z2dlc3Rpb25zLmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIHN1Z2dlc3Rpb25zLmZpbHRlcihcblx0XHRcdFx0XHRcdChpdGVtKSA9PiBpdGVtWydpZCddLnN0YXJ0c1dpdGgoY29udGV4dC5xdWVyeSlcblx0XHRcdFx0XHQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gY2F0Y2gtYWxsIGlmIHRoZXJlIGFyZSBubyBtYXRjaGVzXG4gICAgICAgIHJldHVybiBbeyBsYWJlbDogY29udGV4dC5xdWVyeSB9XTtcbiAgICB9XG5cblx0cmVuZGVyU3VnZ2VzdGlvbihzdWdnZXN0aW9uOiBTdWdnZXN0aW9uLCBlbDogSFRNTEVsZW1lbnQpOiB2b2lkIHtcblx0XHRlbC5zZXRUZXh0KCdAJyArIHN1Z2dlc3Rpb25bJ2lkJ10pO1xuXHRcdGVsLmlubmVySFRNTCArPSAnPGJyPic7XG5cdFx0ZWwuYXBwZW5kKHN1Z2dlc3Rpb25bJ3RpdGxlJ10pO1xuXHR9XG5cblx0c2VsZWN0U3VnZ2VzdGlvbihzdWdnZXN0aW9uOiBTdWdnZXN0aW9uLCBldmVudDogS2V5Ym9hcmRFdmVudCB8IE1vdXNlRXZlbnQpOiB2b2lkIHtcblx0XHRjb25zdCB7IGVkaXRvciB9ID0gdGhpcy5jb250ZXh0O1xuXG5cdFx0Y29uc3QgcHJlY2VkaW5nQ2hhciA9IGVkaXRvci5nZXRSYW5nZSh7bGluZTogdGhpcy5jb250ZXh0LnN0YXJ0LmxpbmUsIGNoOiB0aGlzLmNvbnRleHQuc3RhcnQuY2ggLSAxfSxcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQgIHtsaW5lOiB0aGlzLmNvbnRleHQuc3RhcnQubGluZSwgY2g6IHRoaXMuY29udGV4dC5zdGFydC5jaH0pO1xuXG5cdFx0Y29uc3QgZm9sbG93aW5nQ2hhciA9IGVkaXRvci5nZXRSYW5nZSh7bGluZTogdGhpcy5jb250ZXh0LnN0YXJ0LmxpbmUsIGNoOiB0aGlzLmNvbnRleHQuZW5kLmNofSxcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQgIHtsaW5lOiB0aGlzLmNvbnRleHQuc3RhcnQubGluZSwgY2g6IHRoaXMuY29udGV4dC5lbmQuY2ggKyAxfSk7XG5cblxuXHRcdGNvbnN0IHN1Z2dTdHIgPSAnQCcgKyBzdWdnZXN0aW9uLmlkIDtcblxuXHRcdGxldCBjdXJzb3JFbmRQb3MgPSBudWxsO1xuXG5cdFx0aWYgKGZvbGxvd2luZ0NoYXIgPT0gJ10nKXtcblx0XHRcdGN1cnNvckVuZFBvcyA9IHRoaXMuY29udGV4dC5zdGFydC5jaCArIHN1Z2dTdHIubGVuZ3RoICsgMVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRjdXJzb3JFbmRQb3MgPSB0aGlzLmNvbnRleHQuc3RhcnQuY2ggKyBzdWdnU3RyLmxlbmd0aFxuXHRcdH1cblxuXHRcdGVkaXRvci5yZXBsYWNlUmFuZ2Uoc3VnZ1N0ciwgdGhpcy5jb250ZXh0LnN0YXJ0LCB7J2xpbmUnOiB0aGlzLmNvbnRleHQuZW5kLmxpbmUsICdjaCc6IHRoaXMuY29udGV4dC5lbmQuY2ggfSk7XG5cblx0XHRlZGl0b3Iuc2V0Q3Vyc29yKHsnbGluZSc6IHRoaXMuY29udGV4dC5zdGFydC5saW5lLCAnY2gnOiBjdXJzb3JFbmRQb3N9KVxuXG5cdFx0dGhpcy5qdXN0Q29tcGxldGVkID0gdHJ1ZTtcblxuXHR9XG5cbn1cbiIsICJjb25zdCBodHRwID0gcmVxdWlyZSgnaHR0cCcpO1xuXG5mdW5jdGlvbiBtYWtlSHR0cFJlcXVlc3Qob3B0aW9ucywgZGF0YSkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGNvbnN0IHJlcSA9IGh0dHAucmVxdWVzdChvcHRpb25zLCAocmVzKSA9PiB7XG4gICAgICAgICAgICBsZXQgcmVzcG9uc2VEYXRhID0gJyc7XG5cbiAgICAgICAgICAgIHJlcy5vbignZGF0YScsIChjaHVuaykgPT4ge1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlRGF0YSArPSBjaHVuaztcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXMub24oJ2VuZCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlRGF0YSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmVxLm9uKCdlcnJvcicsIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgIHJlcS53cml0ZShkYXRhKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlcS5lbmQoKTtcbiAgICB9KTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvY2F0ZUNvbGxlY3Rpb24oY29sbGVjdGlvblBhdGgpIHtcbiAgICBjb25zdCBqc29uUnBjRGF0YSA9IHtcbiAgICAgICAganNvbnJwYzogXCIyLjBcIixcbiAgICAgICAgbWV0aG9kOiBcInVzZXIuZ3JvdXBzXCIsXG4gICAgICAgIHBhcmFtczogW3RydWVdXG4gICAgfTtcblxuICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgIGhvc3RuYW1lOiAnbG9jYWxob3N0JyxcbiAgICAgICAgcG9ydDogMjMxMTksXG4gICAgICAgIHBhdGg6ICcvYmV0dGVyLWJpYnRleC9qc29uLXJwYycsXG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuXHRcdFx0J0NvbnRlbnQtTGVuZ3RoJzogSlNPTi5zdHJpbmdpZnkoanNvblJwY0RhdGEpLmxlbmd0aFxuICAgICAgICB9LFxuICAgIH07XG5cbiAgICBjb25zdCByZXNwb25zZVN0ciA9IGF3YWl0IG1ha2VIdHRwUmVxdWVzdChvcHRpb25zLCBKU09OLnN0cmluZ2lmeShqc29uUnBjRGF0YSkpO1xuXHRjb25zdCByZXNwb25zZUpzb24gPSBKU09OLnBhcnNlKHJlc3BvbnNlU3RyKTtcbiAgICBjb25zdCByZXN1bHQgPSByZXNwb25zZUpzb24ucmVzdWx0O1xuXG5cbiAgICBjb25zdCBwbGlzdCA9IGNvbGxlY3Rpb25QYXRoLnNwbGl0KFwiL1wiKTtcbiAgICBjb25zdCBsaWIgPSBwbGlzdFswXTtcbiAgICBjb25zdCBhZnRlciA9IHBsaXN0LnNsaWNlKDEpO1xuXG4gICAgY29uc3QgbGliTmFtZXMgPSByZXN1bHQubWFwKGwgPT4gbC5uYW1lKTtcbiAgICBjb25zdCBsaWJJZHMgPSByZXN1bHQubWFwKGwgPT4gbC5pZCk7XG5cbiAgICBjb25zdCBtYXRjaGVkTGliID0gcmVzdWx0W2xpYk5hbWVzLmluZGV4T2YobGliKV07XG4gICAgY29uc3QgbWF0Y2hlZExpYklkID0gbGliSWRzW2xpYk5hbWVzLmluZGV4T2YobGliKV07XG5cbiAgICBjb25zdCBhbGxDb2xsZWN0aW9ucyA9IG1hdGNoZWRMaWIuY29sbGVjdGlvbnM7XG4gICAgY29uc3QgYWxsQ29sbGVjdGlvbnNEaWN0ID0ge307XG4gICAgYWxsQ29sbGVjdGlvbnMuZm9yRWFjaChjID0+IHtcbiAgICAgICAgYWxsQ29sbGVjdGlvbnNEaWN0W2Mua2V5XSA9IHsgLi4uYywgY2hpbGRyZW46IFtdIH07XG4gICAgfSk7XG5cbiAgICBjb25zdCB0b3BDb2xsZWN0aW9ucyA9IGFsbENvbGxlY3Rpb25zLmZpbHRlcihjID0+ICFjLnBhcmVudENvbGxlY3Rpb24pO1xuICAgIGNvbnN0IHRvcENvbGxlY3Rpb25zRGljdCA9IHt9O1xuICAgIHRvcENvbGxlY3Rpb25zLmZvckVhY2goYyA9PiB7XG4gICAgICAgIHRvcENvbGxlY3Rpb25zRGljdFtjLmtleV0gPSB7IC4uLmMsIGNoaWxkcmVuOiBbXSB9O1xuICAgIH0pO1xuXG4gICAgY29uc3Qgbm9uVG9wQ29sbGVjdGlvbnMgPSBtYXRjaGVkTGliLmNvbGxlY3Rpb25zLmZpbHRlcihjID0+IGMucGFyZW50Q29sbGVjdGlvbiAhPT0gZmFsc2UpO1xuXG4gICAgZm9yIChjb25zdCBjb2xsIG9mIG5vblRvcENvbGxlY3Rpb25zKSB7XG4gICAgICAgIGlmIChjb2xsLnBhcmVudENvbGxlY3Rpb24gaW4gdG9wQ29sbGVjdGlvbnNEaWN0KSB7XG4gICAgICAgICAgICB0b3BDb2xsZWN0aW9uc0RpY3RbY29sbC5wYXJlbnRDb2xsZWN0aW9uXS5jaGlsZHJlbi5wdXNoKGNvbGwpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgbWF0Y2hlZFRvcENvbGxlY3Rpb24gPSB0b3BDb2xsZWN0aW9ucy5maW5kKGMgPT4gYy5uYW1lID09PSBhZnRlclswXSk7XG4gICAgY29uc3QgbWF0Y2hlZFRvcENvbGxlY3Rpb25LZXkgPSBtYXRjaGVkVG9wQ29sbGVjdGlvbi5rZXk7XG5cblxuICAgIGxldCBjaGlsZHJlbiA9IE9iamVjdC52YWx1ZXMoYWxsQ29sbGVjdGlvbnNEaWN0KS5maWx0ZXIoYyA9PiBjLnBhcmVudENvbGxlY3Rpb24gPT09IG1hdGNoZWRUb3BDb2xsZWN0aW9uS2V5KTtcbiAgICBsZXQgbWF0Y2hlZENoaWxkQ29sbGVjdGlvbktleSA9IG51bGw7XG5cblxuICAgIGZvciAoY29uc3QgY25hbWUgb2YgYWZ0ZXIuc2xpY2UoMSkpIHtcbiAgICAgICAgaWYgKG1hdGNoZWRDaGlsZENvbGxlY3Rpb25LZXkpIHtcbiAgICAgICAgICAgIGNoaWxkcmVuID0gT2JqZWN0LnZhbHVlcyhhbGxDb2xsZWN0aW9uc0RpY3QpLmZpbHRlcihjID0+IGMucGFyZW50Q29sbGVjdGlvbiA9PT0gbWF0Y2hlZENoaWxkQ29sbGVjdGlvbktleSk7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIGNoaWxkcmVuKSB7XG5cblx0XHRcdGlmIChjbmFtZSA9PT0gY2hpbGQubmFtZSkge1xuICAgICAgICAgICAgICAgIG1hdGNoZWRDaGlsZENvbGxlY3Rpb25LZXkgPSBjaGlsZC5rZXk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4geyBsaWJyYXJ5SWQ6IG1hdGNoZWRMaWJJZCwgY29sbGVjdGlvbklkOiBtYXRjaGVkQ2hpbGRDb2xsZWN0aW9uS2V5IH07XG59XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGV4cG9ydENvbGxlY3Rpb24oY29sbGVjdGlvbklkLCBsaWJyYXJ5SWQsIGJpYkZvcm1hdCA9ICdiZXR0ZXJiaWJ0ZXgnKSB7XG5cblx0Y29uc3QgdXJsX3BhdGggPSBgL2JldHRlci1iaWJ0ZXgvY29sbGVjdGlvbj8vJHtsaWJyYXJ5SWR9LyR7Y29sbGVjdGlvbklkfS4ke2JpYkZvcm1hdH1gO1xuXG4gICAgY29uc3QgdXJsID0gYGh0dHA6Ly8xMjcuMC4wLjE6MjMxMTkvYmV0dGVyLWJpYnRleC9jb2xsZWN0aW9uPy8ke2xpYnJhcnlJZH0vJHtjb2xsZWN0aW9uSWR9LiR7YmliRm9ybWF0fWA7XG5cblx0Y29uc3Qgb3B0aW9ucyA9IHtcblx0XHRob3N0bmFtZTogJ2xvY2FsaG9zdCcsXG5cdFx0cG9ydDogMjMxMTksXG5cdFx0cGF0aDogdXJsX3BhdGgsXG5cdFx0bWV0aG9kOiAnR0VUJyxcblx0XHRoZWFkZXJzOiB7XG5cdFx0XHQnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuXHRcdFx0fSxcblx0fTtcblxuICAgIGNvbnN0IHJlc3BvbnNlU3RyID0gYXdhaXQgbWFrZUh0dHBSZXF1ZXN0KG9wdGlvbnMpXG5cblx0Y29uc3QgcmVzcG9uc2VKc29uID0gSlNPTi5wYXJzZShyZXNwb25zZVN0cik7XG5cblx0cmV0dXJuIHJlc3BvbnNlSnNvbjtcblxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYmlibGlvZ3JhcGh5KGNpdGVLZXlzLCBmb3JtYXQpIHtcblxuICAgIGNvbnN0IGpzb25ScGNEYXRhID0ge1xuICAgICAgICBqc29ucnBjOiBcIjIuMFwiLFxuICAgICAgICBtZXRob2Q6IFwiaXRlbS5leHBvcnRcIixcbiAgICAgICAgcGFyYW1zOiBbY2l0ZUtleXMsIGZvcm1hdF1cbiAgICB9O1xuXG4gICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgICAgaG9zdG5hbWU6ICdsb2NhbGhvc3QnLFxuICAgICAgICBwb3J0OiAyMzExOSxcbiAgICAgICAgcGF0aDogJy9iZXR0ZXItYmlidGV4L2pzb24tcnBjJyxcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG5cdFx0XHQnQ29udGVudC1MZW5ndGgnOiBKU09OLnN0cmluZ2lmeShqc29uUnBjRGF0YSkubGVuZ3RoXG4gICAgICAgIH0sXG4gICAgfTtcblxuICAgIGNvbnN0IHJlc3BvbnNlU3RyID0gYXdhaXQgbWFrZUh0dHBSZXF1ZXN0KG9wdGlvbnMsIEpTT04uc3RyaW5naWZ5KGpzb25ScGNEYXRhKSk7XG5cdGNvbnN0IHJlc3BvbnNlSnNvbiA9IEpTT04ucGFyc2UocmVzcG9uc2VTdHIpO1xuICAgIGNvbnN0IHJlc3VsdCA9IHJlc3BvbnNlSnNvbi5yZXN1bHQ7XG5cblx0cmV0dXJuIHJlc3VsdFsyXTtcblxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZXhwb3J0SXRlbXMoY2l0ZUtleXMsIHRyYW5zbGF0b3IsIGxpYnJhcnlJRCkge1xuXG4gICAgY29uc3QganNvblJwY0RhdGEgPSB7XG4gICAgICAgIGpzb25ycGM6IFwiMi4wXCIsXG4gICAgICAgIG1ldGhvZDogXCJpdGVtLmV4cG9ydFwiLFxuICAgICAgICBwYXJhbXM6IFtjaXRlS2V5cywgdHJhbnNsYXRvciwgbGlicmFyeUlEXVxuICAgIH07XG5cbiAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICBob3N0bmFtZTogJ2xvY2FsaG9zdCcsXG4gICAgICAgIHBvcnQ6IDIzMTE5LFxuICAgICAgICBwYXRoOiAnL2JldHRlci1iaWJ0ZXgvanNvbi1ycGMnLFxuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcblx0XHRcdCdDb250ZW50LUxlbmd0aCc6IEpTT04uc3RyaW5naWZ5KGpzb25ScGNEYXRhKS5sZW5ndGhcbiAgICAgICAgfSxcbiAgICB9O1xuXG4gICAgY29uc3QgcmVzcG9uc2VTdHIgPSBhd2FpdCBtYWtlSHR0cFJlcXVlc3Qob3B0aW9ucywgSlNPTi5zdHJpbmdpZnkoanNvblJwY0RhdGEpKTtcblx0Y29uc3QgcmVzcG9uc2VKc29uID0gSlNPTi5wYXJzZShyZXNwb25zZVN0cik7XG4gICAgY29uc3QgcmVzdWx0ID0gcmVzcG9uc2VKc29uLnJlc3VsdDtcbiAgICB0cnkgeyBcblx0ICAgIHJldHVybiByZXN1bHRbMl07XG4gICAgfVxuICAgIGNhdGNoIHtcbiAgICAgICAgcmV0dXJuIFwiW11cIjtcbiAgICB9XG4gICAgICAgIFxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXR0YWNobWVudHMoY2l0ZUtleSkge1xuXG4gICAgY29uc3QganNvblJwY0RhdGEgPSB7XG4gICAgICAgIGpzb25ycGM6IFwiMi4wXCIsXG4gICAgICAgIG1ldGhvZDogXCJpdGVtLmF0dGFjaG1lbnRzXCIsXG4gICAgICAgIHBhcmFtczogW2NpdGVLZXldXG4gICAgfTtcblxuICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgIGhvc3RuYW1lOiAnbG9jYWxob3N0JyxcbiAgICAgICAgcG9ydDogMjMxMTksXG4gICAgICAgIHBhdGg6ICcvYmV0dGVyLWJpYnRleC9qc29uLXJwYycsXG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuXHRcdFx0J0NvbnRlbnQtTGVuZ3RoJzogSlNPTi5zdHJpbmdpZnkoanNvblJwY0RhdGEpLmxlbmd0aFxuICAgICAgICB9LFxuICAgIH07XG5cbiAgICBjb25zdCByZXNwb25zZVN0ciA9IGF3YWl0IG1ha2VIdHRwUmVxdWVzdChvcHRpb25zLCBKU09OLnN0cmluZ2lmeShqc29uUnBjRGF0YSkpO1xuXG5cdGNvbnN0IHJlc3BvbnNlSnNvbiA9IEpTT04ucGFyc2UocmVzcG9uc2VTdHIpO1xuXG5cdHJldHVybiByZXNwb25zZUpzb24ucmVzdWx0O1xuXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBleHBvcnRDb2xsZWN0aW9uUGF0aChjb2xsZWN0aW9uUGF0aCwgYmliRm9ybWF0ID0gJ2JldHRlcmJpYnRleCcpIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb2xsID0gYXdhaXQgbG9jYXRlQ29sbGVjdGlvbihjb2xsZWN0aW9uUGF0aClcbiAgICAgICAgY29uc3QgZXhwb3J0ZWRfY29sbGVjdGlvbiA9IGF3YWl0IGV4cG9ydENvbGxlY3Rpb24oY29sbC5jb2xsZWN0aW9uSWQsIGNvbGwubGlicmFyeUlkLCBiaWJGb3JtYXQpO1xuXHRcdHJldHVybiBleHBvcnRlZF9jb2xsZWN0aW9uO1xuXG5cdH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yOicsIGVycm9yKTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjb2xsZWN0aW9uQ2l0ZWtleXMoY29sbGVjdGlvblBhdGgpIHtcbiAgICBjb25zdCByZXN1bHRKc29uID0gYXdhaXQgZXhwb3J0Q29sbGVjdGlvblBhdGgoY29sbGVjdGlvblBhdGgsIFwianNvblwiKTtcbiAgICByZXR1cm4gcmVzdWx0SnNvbi5tYXAoaXRlbSA9PiBpdGVtLmlkKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNvbGxlY3Rpb25DaXRla2V5c1RpdGxlcyhjb2xsZWN0aW9uUGF0aCkge1xuICAgIGNvbnN0IHJlc3VsdEpzb24gPSBhd2FpdCBleHBvcnRDb2xsZWN0aW9uUGF0aChjb2xsZWN0aW9uUGF0aCwgXCJqc29uXCIpO1xuICAgIGNvbnN0IHJlc3VsdF9rZXlzX3RpdGxlID0gcmVzdWx0SnNvbi5tYXAoaXRlbSA9PiB7cmV0dXJuIHsnaWQnOiBpdGVtLmlkLCAndGl0bGUnOiBpdGVtLnRpdGxlfSB9KTtcblx0cmV0dXJuIHJlc3VsdF9rZXlzX3RpdGxlO1xufVxuIiwgImltcG9ydCB7IEl0ZW1WaWV3LCBNYXJrZG93blZpZXcsIFdvcmtzcGFjZUxlYWYsIHNldEljb24gfSBmcm9tICdvYnNpZGlhbic7XG5cbmltcG9ydCBCaWJjaXRlUGx1Z2luIGZyb20gJy4vbWFpbic7XG5pbXBvcnQgeyBleHBvcnRJdGVtcywgYXR0YWNobWVudHMgfSBmcm9tIFwiWm90ZXJvRnVuY3Rpb25zLnRzXCI7XG5cbmV4cG9ydCBjb25zdCBSZWZlcmVuY2VzVmlld1R5cGUgPSAnUmVmZXJlbmNlc1ZpZXcnO1xuXG5leHBvcnQgY2xhc3MgUmVmZXJlbmNlc1ZpZXcgZXh0ZW5kcyBJdGVtVmlldyB7XG4gIHBsdWdpbjogQmliY2l0ZVBsdWdpbjtcbiAgYWN0aXZlTWFya2Rvd25MZWFmOiBNYXJrZG93blZpZXc7XG4gIHJlZmVyZW5jZXM6IFtdO1xuXG4gIGNvbnN0cnVjdG9yKGxlYWY6IFdvcmtzcGFjZUxlYWYsIHBsdWdpbjogQmliY2l0ZVBsdWdpbikge1xuICAgIHN1cGVyKGxlYWYpO1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIHRoaXMuY29udGVudEVsLmFkZENsYXNzKCdiaWJjaXRlLXJlZmVyZW5jZXMnKTtcbiAgICB0aGlzLnNldE5vQ29udGVudE1lc3NhZ2UoKTtcbiAgICB0aGlzLmFkZEFjdGlvbihcInJlZnJlc2gtY3dcIiwgXCJSZWZyZXNoIFJlZmVyZW5jZXNcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5wcm9jZXNzUmVmZXJlbmNlcygpO1xuICAgIH0pXG4gIH1cblxuICBzZXRWaWV3Q29udGVudChiaWI6IEhUTUxFbGVtZW50KSB7XG4gICAgdGhpcy5jb250ZW50RWwuZW1wdHkoKTtcbiAgICB0aGlzLmJ1dHRvbiA9IHRoaXMuY29udGVudEVsLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHsgdGV4dDogXCJSZWZyZXNoIEJpYmlvZ3JhcGh5XCIgfSk7XG4gICAgdGhpcy5idXR0b24ub25jbGljayA9IChlKSA9PiB7XG4gICAgICB0aGlzLnByb2Nlc3NSZWZlcmVuY2VzKCk7XG4gICAgfVxuICAgIGlmICghYmliKSB7XG4gICAgICB0aGlzLnNldE5vQ29udGVudE1lc3NhZ2UoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jb250ZW50RWwuYXBwZW5kKGJpYik7XG4gICAgfVxuICB9XG5cbiAgc2V0Tm9Db250ZW50TWVzc2FnZSgpIHtcbiAgICB0aGlzLnNldE1lc3NhZ2UoJ05vIGNpdGF0aW9ucyBmb3VuZCBpbiB0aGUgY3VycmVudCBkb2N1bWVudC4nKTtcbiAgfVxuXG4gIHNldE1lc3NhZ2UobWVzc2FnZTogc3RyaW5nKSB7XG4gICAgdGhpcy5jb250ZW50RWwuZW1wdHkoKTtcbiAgICB0aGlzLmJ1dHRvbiA9IHRoaXMuY29udGVudEVsLmNyZWF0ZUVsKFwiYnV0dG9uXCIsIHsgdGV4dDogXCJSZWZyZXNoIEJpYmlvZ3JhcGh5XCIgfSk7XG4gICAgdGhpcy5idXR0b24ub25jbGljayA9IChlKSA9PiB7XG4gICAgICB0aGlzLnByb2Nlc3NSZWZlcmVuY2VzKCk7XG4gICAgfVxuICAgIHRoaXMuY29udGVudEVsLmNyZWF0ZURpdih7XG4gICAgICBjbHM6ICdwYW5lLWVtcHR5JyxcbiAgICAgIHRleHQ6IG1lc3NhZ2UsXG4gICAgfSk7XG4gIH1cblxuICBnZXRWaWV3VHlwZSgpIHtcbiAgICByZXR1cm4gUmVmZXJlbmNlc1ZpZXdUeXBlO1xuICB9XG5cbiAgZ2V0RGlzcGxheVRleHQoKSB7XG4gICAgcmV0dXJuICdSZWZlcmVuY2VzJztcbiAgfVxuXG4gIGdldEljb24oKSB7XG4gICAgcmV0dXJuICdncmFkdWF0aW9uLWNhcCc7XG4gIH1cblxuICBwcm9jZXNzUmVmZXJlbmNlcyA9IGFzeW5jICgpID0+IHtcblxuICAgIGNvbnN0IHJlZnMgPSBhd2FpdCB0aGlzLnBsdWdpbi5wcm9jZXNzUmVmZXJlbmNlcygpO1xuXG4gICAgdGhpcy5zZXRWaWV3Q29udGVudChhd2FpdCB0aGlzLnJlbmRlclJlZmVyZW5jZXMocmVmcykpXG5cbiAgfTtcblxuICBhc3luYyByZW5kZXJSZWZlcmVuY2VzKHJlZnNBcnJheSkge1xuICAgIGNvbnN0IGNvbnRhaW5lckRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG4gICAgXG4gICAgY29uc3QgcmVmRGF0YSA9IEpTT04ucGFyc2UoYXdhaXQgZXhwb3J0SXRlbXMocmVmc0FycmF5LCBcImpzb25cIiwgXCJFTlRcIikpXG5cbiAgICBjb25zb2xlLmxvZyhyZWZzQXJyYXkpO1xuICAgIFxuICAgIGZvciAoY29uc3QgaXRlbSBvZiByZWZzQXJyYXkpIHtcbiAgICAgIGNvbnN0IGl0ZW1EaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIGl0ZW1EaXYuY2xhc3NMaXN0LmFkZCgncmVmZXJlbmNlLWRpdicpO1xuXG4gICAgICBjb25zdCBpdGVtRGF0YSA9IHJlZkRhdGEuZmxhdCgxKS5maWx0ZXIociA9PiByWydpZCddID09IGl0ZW0pWzBdXG5cbiAgICAgIGl0ZW1EYXRhWydhdHRhY2htZW50cyddID0gYXdhaXQgYXR0YWNobWVudHMoaXRlbSlcblxuICAgICAgY29uc3QgaXRlbUF0dGFjaG1lbnRzID0gaXRlbURhdGFbJ2F0dGFjaG1lbnRzJ10uZmlsdGVyKGF0dGFjaCA9PiBhdHRhY2gucGF0aCAhPSBmYWxzZSlcblxuXG4gICAgICBpdGVtRGl2LmlubmVySFRNTCArPSBgPGRpdiBjbGFzcz1cInJlZmVyZW5jZS1jaXRla2V5XCI+QCR7aXRlbURhdGFbJ2lkJ119PGRpdj5gO1xuXG4gICAgICBpZiAoaXRlbUF0dGFjaG1lbnRzLmxlbmd0aCl7XG4gICAgICAgIGNvbnN0IGxpbmtBdHRhY2htZW50ID0gaXRlbUF0dGFjaG1lbnRzWzBdWydvcGVuJ11cbiAgICAgICAgaXRlbURpdi5pbm5lckhUTUwgKz0gYDxkaXYgY2xhc3M9XCJyZWZlcmVuY2UtdGl0bGVcIj48YSBocmVmPScke2xpbmtBdHRhY2htZW50fSc+JHtpdGVtRGF0YVsndGl0bGUnXX08L2E+PC9kaXY+YDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGl0ZW1EaXYuaW5uZXJIVE1MICs9IGA8ZGl2IGNsYXNzPVwicmVmZXJlbmNlLXRpdGxlXCI+JHtpdGVtRGF0YVsndGl0bGUnXX08L2Rpdj5gO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBqb3VybmFsID0gaXRlbURhdGFbJ2NvbnRhaW5lci10aXRsZS1zaG9ydCddICE9ICcnID8gaXRlbURhdGFbJ2NvbnRhaW5lci10aXRsZS1zaG9ydCddIDogaXRlbURhdGFbJ2NvbnRhaW5lci10aXRsZSddXG4gICAgICBjb25zdCBpc3N1ZURhdGUgPSBpdGVtRGF0YVsnaXNzdWVkJ11bJ2RhdGUtcGFydHMnXVswXVswXSAhPSB1bmRlZmluZWQgPyBpdGVtRGF0YVsnaXNzdWVkJ11bJ2RhdGUtcGFydHMnXVswXVswXSA6ICcnXG5cbiAgICAgIGl0ZW1EaXYuaW5uZXJIVE1MICs9IGA8ZGl2IGNsYXNzPVwicmVmZXJlbmNlLWpvdXJuYWxcIj4ke2pvdXJuYWx9ICR7aXNzdWVEYXRlfTwvZGl2PmA7XG5cbiAgICAgIGNvbnRhaW5lckRpdi5hcHBlbmRDaGlsZChpdGVtRGl2KTtcblxuICB9XG5cbiAgICByZXR1cm4gY29udGFpbmVyRGl2O1xuXG4gIH07XG5cbn1cbiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxJQUFBQSxtQkFBMkc7OztBQ0EzRyxzQkFXTzs7O0FDWFAsSUFBTSxPQUFPLFFBQVEsTUFBTTtBQUUzQixTQUFTLGdCQUFnQixTQUFTLE1BQU07QUFDcEMsU0FBTyxJQUFJLFFBQVEsQ0FBQyxTQUFTLFdBQVc7QUFDcEMsVUFBTSxNQUFNLEtBQUssUUFBUSxTQUFTLENBQUMsUUFBUTtBQUN2QyxVQUFJLGVBQWU7QUFFbkIsVUFBSSxHQUFHLFFBQVEsQ0FBQyxVQUFVO0FBQ3RCLHdCQUFnQjtBQUFBLE1BQ3BCLENBQUM7QUFFRCxVQUFJLEdBQUcsT0FBTyxNQUFNO0FBQ2hCLGdCQUFRLFlBQVk7QUFBQSxNQUN4QixDQUFDO0FBQUEsSUFDTCxDQUFDO0FBRUQsUUFBSSxHQUFHLFNBQVMsQ0FBQyxVQUFVO0FBQ3ZCLGFBQU8sS0FBSztBQUFBLElBQ2hCLENBQUM7QUFFRCxRQUFJLE1BQU07QUFDTixVQUFJLE1BQU0sSUFBSTtBQUFBLElBQ2xCO0FBRUEsUUFBSSxJQUFJO0FBQUEsRUFDWixDQUFDO0FBQ0w7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QUFBLE1BQ1Q7QUFBQztBQUFBLElBQ0Y7QUFBQTtBQUFBLEVBOUpBLE1BQU0sU0FBUztBQUVkLFlBQVEsSUFBSSx5QkFBeUI7QUFFckMsVUFBTSxLQUFLLGFBQWE7QUFFeEIsU0FBSyxzQkFBc0IsSUFBSSxnQkFBZ0IsS0FBSyxLQUFLLElBQUksQ0FBQztBQUU5RCxTQUFLO0FBQUEsTUFBYTtBQUFBLE1BQ2IsQ0FBQyxTQUF3QixJQUFJLGVBQWUsTUFBTSxJQUFJO0FBQUEsSUFDckQ7QUFFTixTQUFLLFdBQVc7QUFBQSxNQUNmLElBQUk7QUFBQSxNQUNKLE1BQU07QUFBQSxNQUNOLFVBQVUsWUFBWTtBQUNyQixhQUFLLFNBQVM7QUFBQSxNQUNmO0FBQUEsSUFDRCxDQUFDO0FBT0QsVUFBTSxLQUFLLFNBQVM7QUFBQSxFQWlFckI7QUFBQSxFQUVBLFdBQVc7QUFDVixTQUFLLElBQUksVUFBVSxnQkFBZ0Isa0JBQWtCLEVBQ3BELFFBQVEsQ0FBQyxTQUFTLEtBQUssT0FBTyxDQUFDO0FBQUEsRUFDakM7QUFBQSxFQUVBLE1BQU0sZUFBZTtBQUNwQixTQUFLLFdBQVcsT0FBTyxPQUFPLENBQUMsR0FBRyxrQkFBa0IsTUFBTSxLQUFLLFNBQVMsQ0FBQztBQUFBLEVBQzFFO0FBQUEsRUFFQSxNQUFNLGVBQWU7QUFDcEIsVUFBTSxLQUFLLFNBQVMsS0FBSyxRQUFRO0FBQUEsRUFDbEM7QUFBQSxFQUVBLElBQUksT0FBTztBQUNWLFVBQU0sU0FBUyxLQUFLLElBQUksVUFBVSxnQkFBZ0Isa0JBQWtCO0FBQ3BFLFFBQUksRUFBQyxpQ0FBUTtBQUFRLGFBQU87QUFDNUIsV0FBTyxPQUFPLENBQUMsRUFBRTtBQUFBLEVBQ2xCO0FBQUEsRUFFQSxNQUFNLFdBQVc7QUFDaEIsUUFBSSxLQUFLO0FBQU0sYUFBTyxLQUFLLFdBQVc7QUFFdEMsVUFBTSxLQUFLLElBQUksVUFBVSxhQUFhLEtBQUssRUFBRSxhQUFhO0FBQUEsTUFDekQsTUFBTTtBQUFBLElBQ1AsQ0FBQztBQUVELFNBQUssV0FBVztBQUVoQixVQUFNLGFBQWEsS0FBSyxJQUFJLFVBQVUsb0JBQW9CLDZCQUFZO0FBQ3RFLFFBQUksWUFBWTtBQUNmLFdBQUssa0JBQWtCO0FBQUEsSUFDeEI7QUFBQSxFQUNEO0FBQUEsRUFFQSxhQUFhO0FBQ1osVUFBTSxTQUFTLEtBQUssSUFBSSxVQUFVLGdCQUFnQixrQkFBa0I7QUFDcEUsUUFBSSxFQUFDLGlDQUFRO0FBQVE7QUFDckIsU0FBSyxJQUFJLFVBQVUsV0FBVyxPQUFPLENBQUMsQ0FBQztBQUFBLEVBQ3hDO0FBNkJEOyIsCiAgIm5hbWVzIjogWyJpbXBvcnRfb2JzaWRpYW4iLCAiaW1wb3J0X29ic2lkaWFuIl0KfQo=
